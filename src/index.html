<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Minesweeper Mobile</title>

<style>
body {
  margin: 0;
  background: #1e1f26;
  overflow: hidden;
  user-select: none;
  color: #d6d8e5;
}

canvas {
  display: block;
  touch-action: none;
}

#menuOverlay {
  position: fixed;
  inset: 0;
  background: rgba(20,22,35,0.85);
  display: flex;
  align-items: center;
  justify-content: center;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.3s ease;
}

#menuOverlay.show {
  opacity: 1;
  pointer-events: auto;
}

#menuCard {
  background: #2f344d;
  border-radius: 18px;
  padding: 26px;
  width: 80%;
  max-width: 320px;
  text-align: center;
  transform: scale(0.5);
  transition: transform 0.35s ease;
  box-shadow: 0 20px 40px rgba(0,0,0,0.4);
}

#menuOverlay.show #menuCard {
  transform: scale(1);
}

button {
  margin-top: 18px;
  padding: 12px 26px;
  font-size: 16px;
  border-radius: 10px;
  border: none;
  background: #7c83ff;
  color: #ffffff;
}
</style>
</head>

<body>

<canvas id="game"></canvas>

<div id="menuOverlay">
  <div id="menuCard">
    <h2 id="menuText"></h2>
    <p id="menuScore"></p>
    <button onclick="generateBoard()">New Game</button>
  </div>
</div>

<script>
/* ---------- CONFIG ---------- */
const COLS = 10;
const HUD_ROWS = 3;
const CELL_SIZE = Math.floor(window.innerWidth / COLS);
const TOTAL_ROWS = Math.floor(window.innerHeight / CELL_SIZE);
const ROWS = TOTAL_ROWS - HUD_ROWS;
const BOMB_COUNT = Math.floor(ROWS * COLS * 0.15);

/* ---------- CANVAS ---------- */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = COLS * CELL_SIZE;
canvas.height = TOTAL_ROWS * CELL_SIZE;

/* ---------- VERTICAL OFFSET ---------- */
const verticalOffset = window.innerHeight - TOTAL_ROWS * CELL_SIZE;

/* ---------- STATE ---------- */
let board, revealed, flags, bombs;
let gameOver = false;
let startTime, elapsedTime = 0, timerRunning = false;

/* ---------- NUMBER COLORS (PASTEL) ---------- */
const NUM_COLORS = {
  1:"#8fa8ff",
  2:"#7fd1ae",
  3:"#f28b82",
  4:"#9aa4ff",
  5:"#ff9aa2",
  6:"#7fcfd4",
  7:"#cfcfe8",
  8:"#a0a4c4"
};

/* ---------- GAME SETUP ---------- */
function generateBoard() {
  board = Array.from({length: ROWS}, ()=>Array(COLS).fill(0));
  revealed = Array.from({length: ROWS}, ()=>Array(COLS).fill(false));
  flags = Array.from({length: ROWS}, ()=>Array(COLS).fill(false));
  bombs = new Set();

  while (bombs.size < BOMB_COUNT) {
    const r = Math.floor(Math.random() * ROWS);
    const c = Math.floor(Math.random() * COLS);
    bombs.add(`${r},${c}`);
    board[r][c] = -1;
  }

  for (let r=0;r<ROWS;r++) for (let c=0;c<COLS;c++) {
    if (board[r][c] === -1) continue;
    let count = 0;
    for (let dr=-1;dr<=1;dr++) for (let dc=-1;dc<=1;dc++) {
      const nr=r+dr,nc=c+dc;
      if (nr>=0&&nr<ROWS&&nc>=0&&nc<COLS&&board[nr][nc]===-1) count++;
    }
    board[r][c] = count;
  }

  gameOver = false;
  startTime = Date.now();
  elapsedTime = 0;
  timerRunning = true;
  document.getElementById("menuOverlay").classList.remove("show");
}

/* ---------- HELPERS ---------- */
function reveal(r,c){
  if (revealed[r][c] || flags[r][c]) return;
  revealed[r][c] = true;
  if (board[r][c] === 0)
    for (let dr=-1;dr<=1;dr++) for (let dc=-1;dc<=1;dc++) {
      const nr=r+dr,nc=c+dc;
      if (nr>=0&&nr<ROWS&&nc>=0&&nc<COLS) reveal(nr,nc);
    }
}

function revealAllBombs(){
  bombs.forEach(b=>{
    const [r,c]=b.split(",").map(Number);
    revealed[r][c]=true;
  });
}

function checkWin(){
  for (let r=0;r<ROWS;r++) for (let c=0;c<COLS;c++)
    if (board[r][c]!==-1 && !revealed[r][c]) return false;
  return true;
}

function showMenu(win){
  timerRunning = false;
  gameOver = true;
  document.getElementById("menuText").textContent = win ? "You Win!" : "Game Over";
  document.getElementById("menuScore").textContent = `Time: ${elapsedTime}s`;
  setTimeout(()=>document.getElementById("menuOverlay").classList.add("show"),2000);
}

/* ---------- DRAW ---------- */
function draw(){
  ctx.clearRect(0,0,canvas.width,canvas.height);

  if (timerRunning)
    elapsedTime = Math.floor((Date.now()-startTime)/1000);

  // HUD text
  ctx.fillStyle = "#d6d8e5";
  ctx.font = `${CELL_SIZE}px Arial`;
  const flagsUsed = flags.flat().filter(Boolean).length;
  ctx.fillText(`Mines: ${BOMB_COUNT - flagsUsed}`, 12, CELL_SIZE * 2 + verticalOffset);
  ctx.fillText(`Time: ${elapsedTime}s`, canvas.width - CELL_SIZE * 4.2, CELL_SIZE * 2 + verticalOffset);

  // Grid
  for (let r=0;r<ROWS;r++) for (let c=0;c<COLS;c++) {
    const x = c * CELL_SIZE;
    const y = verticalOffset + (r + HUD_ROWS) * CELL_SIZE;

    ctx.fillStyle = revealed[r][c] ? "#2a2f3f" : "#3a3f58";
    ctx.fillRect(x,y,CELL_SIZE,CELL_SIZE);

    if (revealed[r][c] && board[r][c] > 0) {
      ctx.fillStyle = NUM_COLORS[board[r][c]];
      ctx.font = `${CELL_SIZE/2}px Arial`;
      ctx.fillText(board[r][c], x + CELL_SIZE/3, y + CELL_SIZE/1.7);
    }


    if (flags[r][c] && !revealed[r][c]) {
    ctx.font = `${CELL_SIZE-26}px Arial`;
    ctx.fillText("ðŸš©", x+6, y+CELL_SIZE-6);
    }


    if (revealed[r][c] && board[r][c] === -1) {
      ctx.fillStyle = "#e57373";
      ctx.beginPath();
      ctx.arc(x+CELL_SIZE/2,y+CELL_SIZE/2,CELL_SIZE/4,0,Math.PI*2);
      ctx.fill();
    }

    ctx.strokeStyle="#4a5070";
    ctx.strokeRect(x,y,CELL_SIZE,CELL_SIZE);
  }
}

/* ---------- TOUCH INPUT ---------- */
let pressTimer, longPress=false;

canvas.addEventListener("touchstart", e=>{
  const rect=canvas.getBoundingClientRect();
  const t=e.touches[0];
  const mx=t.clientX-rect.left;
  const my=t.clientY-rect.top;

  const gridY = Math.floor((my - verticalOffset) / CELL_SIZE);
  if (gridY < HUD_ROWS || gameOver) return;

  const r = gridY - HUD_ROWS;
  const c = Math.floor(mx / CELL_SIZE);
  if (revealed[r][c]) return;

  longPress=false;
  pressTimer=setTimeout(()=>{
    if (!revealed[r][c]) flags[r][c]=!flags[r][c];
    longPress=true;
  },400);
});

canvas.addEventListener("touchend", e=>{
  clearTimeout(pressTimer);
  if (longPress) return;

  const rect=canvas.getBoundingClientRect();
  const t=e.changedTouches[0];
  const mx=t.clientX-rect.left;
  const my=t.clientY-rect.top;

  const gridY = Math.floor((my - verticalOffset) / CELL_SIZE);
  if (gridY < HUD_ROWS || gameOver) return;

  const r = gridY - HUD_ROWS;
  const c = Math.floor(mx / CELL_SIZE);

  if (board[r][c] === -1) {
    revealAllBombs();
    showMenu(false);
  } else {
    reveal(r,c);
    if (checkWin()) showMenu(true);
  }
});

/* ---------- START ---------- */
generateBoard();
function loop(){ draw(); requestAnimationFrame(loop); }
loop();
</script>
</body>
</html>
